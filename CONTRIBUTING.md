# Contributing

Guide for contributors

### Setup

> TODO: put all this in an install.sh

Copying over environment variables:

```bash
cp .env.template .env # copy over to .env file
```

Then change the variables in the `.env` file to the correct values.

Installing dependencies:

```bash
npm i # install local dependencies
npm i -g nodemon webpack webpack-cli typescript ts-node # install global dependencies
```

**Installing MongoDB:**

You will need a MongoDB instance running in order for the application to work correctly. We recommend using [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) to set up a cluster. Another option is to [install MongoDB locally](https://www.mongodb.com/download-center/community) and run it.

In addition, we recommend getting [MongoDB Compass](https://www.mongodb.com/download-center/compass) to view and edit data easily.

### Running the app:

```bash
npm start # runs backend + frontend, both reloading on changes
```

Now to go `localhost:8081` to see the page.
NOTE: you can also go to `localhost:8080/graphql` to see an interactive GraphQL IDE to try out queries and mutations.

### Testing

We use Jest for testing. Snapshot testing is mostly for frontend, while mocking is preferable for backend.

Our local jest tests use the `--only-changed` option, which runs tests only for files that are actually changed, to speed up testing. NOTE: the CI will run all the tests regardless.

Jest configs are split using projects into specific backend and frontend configurations (see [./jest.config.js](./jest.config.js))

Running tests

```bash
npm run check:test # runs only changed tests
npm run check:test:ci # runs all tests
```

### Linting

We use Eslint for linting. The linting tests are cached with the `--cache` option.

NOTE: there are multiple eslint files. The rules are cascaded with the rule in the more specific directory taking priority (see [Eslint cascading hierarchy](https://eslint.org/docs/user-guide/configuring#configuration-cascading-and-hierarchy))

- client config: [./src/client/.eslintrc.js](./src/client/.eslintrc.js)
- server config: [./src/server/.eslintrc.js](./src/server/.eslintrc.js)
- general config: [./.eslintrc.js](./.eslintrc.js)

```bash
npm run check:lint # runs the linter
npm run check:lint:fix # runs the linter with autofix
```

### Folder Structure

- `/__mocks__` - mocks for testing
- `/__snapshots__` - jest snapshots for frontend testing
- `/.vscode` - contains vscode workspace settings, recommended plugins, and launch debug config
- `/src`
  - `/client`
    - `/assets` - static assets
      - `/routes.js` - all frontend routes mapped to React components
    - `/components` - all frontend components
    - `/contexts`
    - `/generated` - autogenerated files, don't modify
    - `/routes`
  - `/common`
  - `/server`
    - `/auth` - authentication
    - `/generated` - autogenerated files, don't modify
    - `index.ts` - main Express API server and Apollo Server
    - `models.ts` - graphql models
    - `resolvers.ts` - graphql resolvers
- `// lots of config files here`

NOTE: We use [dotansimha/graphql-code-generator](https://github.com/dotansimha/graphql-code-generator) for automatic code generation. The mappings for schema models to db models are in [./codegen.json](./codegen.json).

### General Architecture

Schemas:

- [./src/common/schema.graphql](./src/common/schema.graphql) - main schema, shared among server and client
- [./src/client/routes/team/teams.graphql](./src/client/routes/team/teams.graphql) - team data
- [./src/client/routes/profile/user.graphql](./src/client/routes/profile/user.graphql) - for a specific user
- [./src/client/routes/manage/hackers.graphql](./src/client/routes/manage/hackers.graphql) - hacker table
- [./src/client/me.graphql](./src/common/schema.graphql) - personal logged in user

Models:
In [./src/server/models](./src/server/models)

Resolvers:
In [./src/server/resolvers](./src/server/resolvers)

### Tooling

We use:

- Jest for testing
- Circle CI
- Eslint (there's a different config for server and client)
- Prettier (can be used with `npm format` but we also use the eslint integration)
- [Ts-node-dev](https://github.com/whitecolor/ts-node-dev) for auto reloading server
- [dotansimha/graphql-code-generator](https://github.com/dotansimha/graphql-code-generator) for automatic code generation
- Webpack Dev Server
- [TypeDoc](https://typedoc.org/) - for documentation

### Bots

- Dependabot Preview - makes PRs for dependency upgrades (set to monthly updates, configure in [Dashboard](https://app.dependabot.com)
- Codecov - creates code coverage report for each PR, works with Circle CI

### Github Actions

In this repo, Github Actions are used for:

- delete merged PR branches
- automatically create draft PRs for pushed branches
