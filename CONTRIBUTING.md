# Contributing

Guide for contributors

### Setup

You will need [npm](https://github.com/npm/cli) as a package manager and build runner.

Run `./scripts/install.sh` from the top level of the Vaken repository. Note that the variables in
the new `.env` file will need to be changed to valid values.

**Installing MongoDB:**

You will need a MongoDB instance running in order for the application to work correctly. We recommend using [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) to set up a cluster. Another option is to [install MongoDB locally](https://www.mongodb.com/download-center/community) and run it.

In addition, we recommend getting [MongoDB Compass](https://www.mongodb.com/download-center/compass) to view and edit data easily.

### Running the app:

```bash
npm run dev # runs backend + frontend, both reloading on changes
```

Now to go `localhost:8081` to see the page.
NOTE: you can also go to `localhost:8080/graphql` to see an interactive GraphQL IDE to try out queries and mutations (disabled in production env by default).

To create a production build, run `npm build`.


### Testing

We use Jest for testing. Snapshot testing is mostly for frontend, while mocking is preferable for backend.

Our local jest tests use the `--only-changed` option, which runs tests only for files that are actually changed, to speed up testing. NOTE: the CI will run all the tests regardless.

Jest configs are split using projects into specific backend and frontend configurations (see [./jest.config.js](./jest.config.js))

Running tests

```bash
npm run check:test # runs only changed tests
npm run check:test:ci # runs all tests
```

### Linting

We use Eslint for linting. The linting tests are cached with the `--cache` option.

NOTE: there are multiple eslint files. The rules are cascaded with the rule in the more specific directory taking priority (see [Eslint cascading hierarchy](https://eslint.org/docs/user-guide/configuring#configuration-cascading-and-hierarchy))

- client-specific config: [./src/client/.eslintrc.js](./src/client/.eslintrc.js)
- common (shared between server+client) config: [./.eslintrc.js](./.eslintrc.js)

```bash
npm run check:lint # runs the linter
npm run check:lint:fix # runs the linter with autofix
```

### Folder Structure

- `/__mocks__` - mocks for testing
- `/__snapshots__` - jest snapshots for frontend testing
- `/.vscode` - vscode workspace settings, recommended plugins, and launch debug config
- `/scripts` - runnable scripts to do certain tasks (install, populate DB, make an organizer, make a volunteer, etc.)
- `/src`
  - `/client`
    - `/assets` - static assets
      - `/routes.js` - all frontend routes mapped to React components
    - `/components` - all frontend components
    - `/contexts`
    - `/generated` - autogenerated files, don't modify
    - `/routes`
  - `/common`
  - `/server`
    - `/auth` - authentication
    - `/generated` - autogenerated files, don't modify
    - `index.ts` - main Express API server and Apollo Server
    - `models.ts` - graphql models
    - `resolvers.ts` - graphql resolvers
- `/types` - misc. type declaration files
- `// lots of config files here`

NOTE: We use [dotansimha/graphql-code-generator](https://github.com/dotansimha/graphql-code-generator) for automatic code generation. The mappings for schema models to db models are in [./codegen.json](./codegen.json).

### General Architecture

Schemas:

- [./src/common/schema.graphql.ts](./src/common/schema.graphql.ts) - main schema, shared among server and client
- [./src/client/routes/team/teams.graphql.ts](./src/client/routes/team/teams.graphql.ts) - team data
- [./src/client/routes/profile/user.graphql.ts](./src/client/routes/profile/user.graphql.ts) - for a specific user
- [./src/client/routes/manage/hackers.graphql.ts](./src/client/routes/manage/hackers.graphql.ts) - hacker table
- [./src/client/me.graphql.ts](./src/common/schema.graphql.ts) - personal logged in user

Models:
In [./src/server/models.ts](./src/server/models.ts)

Resolvers:
In [./src/server/resolvers.ts](./src/server/resolvers.ts)

### Tooling

We use:

- Jest for testing
- Circle CI
- Eslint (there's a different config for server and client)
- Prettier (can be used with `npm format` but we also use the eslint integration)
- [Ts-node-dev](https://github.com/whitecolor/ts-node-dev) for auto reloading server
- [dotansimha/graphql-code-generator](https://github.com/dotansimha/graphql-code-generator) for automatic code generation
- Webpack Dev Server
- [TypeDoc](https://typedoc.org/) - for documentation

### Bots

- Dependabot Preview - makes PRs for dependency upgrades (set to monthly updates, configure in [Dashboard](https://app.dependabot.com)
- Codecov - creates code coverage report for each PR, works with Circle CI

### Github Actions

In this repo, Github Actions are used for:

- delete merged PR branches

## Asking Questions

Have a Question? Feel free to shoot us an email at [dev@vandyhacks.org](mailto:dev@vandyhacks.org) or open an issue in this repo. 

## Providing Feedback

Your comments and feedback are more than welcome. Feel free to reach us at [dev@vandyhacks.org](mailto:dev@vandyhacks.org).

## Reporting Issues

If you believe you have found a defect in Vaken or its documentation, use the issue tracker to report the problem to us.

## Contributing Fixes
	
### Work Branches

Development should be occurring on their own branches. 

If you are fixing an existing bug in Vaken, your branch name should be `fix/{bug_name}`. 
If your branch is adding a new feature to Vaken, your branch name should be `feat/{feature_name}`. `feature_name` and `bug_name` should be extremely brief. 
During development, you are free to force push to your own branches to make the commit history more clear. 
All the commit messages should be clear and concise. 

Some good habits that we request you to follow:

- Commit messages should be imperative
```
Fix typo in auth
```
over 
```
Fixed typo in auth
```

- Add a body to the commit messages if your subject crosses 50 chars
```
Add function

Add a function which does this.
This should help in this way.

Fixes #6460
```
over
```
Add function which helps us in this way. Also, fixes #6460.
```

If the feature is large, consider breaking it into multiple pull requests. 
For example, if building a new feature that touches all parts of the stack consider separate PRs for:

- Database migration and schema/model changes
- Back end controller/resolver endpoints
- Front end views and usage of endpoints
- Update legacy code

### Pull Requests

Before creating a Pull Request, rebase master onto your branch and push to Github .

In the PR, include clear description of the change and a test plan, if needed.

Always create one pull request per issue and link the issue in the pull request. Never merge multiple requests 
in one unless they have the same root cause.

Pull requests should contain tests whenever needed.

Delete the branch after the PR has been merged.

# Thank You!

Your contributions make Vaken possible. Thank you for taking the time to contribute.

